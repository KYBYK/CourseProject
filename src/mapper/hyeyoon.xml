<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hyeyoon">


   <!-- ***************************************** StudentExam 시작 ***************************************** -->
   <resultMap type="vo.ExamVO" id="exam">
      <association property="sbvo" javaType="vo.SubjectVO"
         select="hyeyoon.getSubject" column="sb_idx" />
   </resultMap>
      
   <!-- "로그인한 학생의 idx로" "수강 신청"한 과목들 중 "시험이 존재하는"목록 리스트를 불러옴 -->
   <select id="examList" resultMap="exam" parameterType="Map">
      SELECT st.st_name, s.sb_name, e.e_name, e.e_idx, e.sb_idx
      FROM
      ((student_t st INNER JOIN student_subject_t ss
      ON st.st_idx =
      ss.st_idx) INNER JOIN exam_t e
      ON ss.sb_idx = e.sb_idx) INNER JOIN
      subject_t s
      ON s.sb_idx = e.sb_idx
      WHERE st.st_yn = #{st_yn}
      AND ss.ss_yn
      = #{ss_yn}
      AND st.st_idx = (SELECT st_idx FROM login_t WHERE st_idx =
      #{st_idx});
   </select>
   <!-- ***************************************** StudentExaml 끝 ***************************************** -->   
   
   <!-- ***************************************** Quiz 시작 ***************************************** -->
  <!-- <resultMap type="vo.QuizVO" id="quiz">
      <id property="e_idx" column="e_idx" />

       <collection property="q_list" ofType="vo.QuizVO"
         select="hyeyoon.quizList" column="e_idx" /> 
   </resultMap>
   -->
   
   <!-- 선택한 시험의 시험 문제들 / 문제수는 q_list.size()로 뽑아 -->
   <select id="quizList" resultType="vo.QuizVO" parameterType="String">
      select *
      from quiz_t
      where e_idx = #{e_idx}                          
   </select>
   
   <insert id="insertQuizAns" parameterType="Map">
   		insert into exam_submit_t(e_idx, st_idx, q_idx, esu_answer) values(#{st_idx},#{e_idx},#{q_idx},#{esu_answer})
   </insert>
   
   <update id="updateQuizAns" parameterType="Map">
   		update exam_submit_t set esu_answer = #{esu_answer}
   		where st_idx = #{st_idx}
   		and e_idx = #{e_idx}
   		and q_idx = #{q_idx}
   		
   </update>
   
   <select id="solveChk" resultType="vo.ExamSubmitVO" parameterType="Map">
   		select *
   		from exam_submit_t
   		where e_idx = #{e_idx}
   		and st_idx = #{st_idx}
   		and q_idx = #{q_idx}
   </select>

<!--     안푼문제 중에 제일 작은 번호 문제 
   <select id="minQuizCnt" resultType="String" parameterType="">
      select min(q.q_cnt)
      from quiz_t q inner join exam_submit_t es
      on q.q_idx = es.q_idx
      where es.esu_answer IS NULL
      group by q.e_idx;
   </select> -->
   
   
   <!-- ***************************************** Quiz 끝 ***************************************** -->

<!-- ***************************************** Subject 시작 ***************************************** -->
    <select id="all" resultType="vo.SubjectVO">
     SELECT * FROM subject_t
     WHERE p_idx = 1
  </select>
  
  <select id="getSubject" parameterType="String" resultType="vo.SubjectVO">
     select * from subject_t
     where sb_idx = #{no}
  </select>
  <!-- ***************************************** Subject 끝 ***************************************** -->
</mapper>
  